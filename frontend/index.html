<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ML-Web · Дашборд анализа тональности</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
    <script src="app.js" defer></script>
  </head>
  <body>
    <header class="topbar">
      <div class="brand">
        <div class="brand__logo">HC</div>
        <div>
          <p class="muted">Hack Change 2025</p>
          <strong>ML/Web · Аналитика обращений</strong>
        </div>
      </div>
      <div class="topbar__actions">
        <div class="chip chip--progress" id="macro-f1-chip">NRP Progress <span id="macro-f1-chip-value">—</span></div>
        <button class="ghost" type="button" onclick="document.getElementById('bulk-form').scrollIntoView({ behavior: 'smooth' })">
          Загрузить CSV
        </button>
        <button class="primary" type="button" onclick="document.getElementById('analyze-form').scrollIntoView({ behavior: 'smooth' })">
          Анализ
        </button>
        <button class="secondary" type="button" onclick="document.getElementById('reports').scrollIntoView({ behavior: 'smooth' })">
          Экспорт
        </button>
      </div>
    </header>

    <main class="layout">
      <section class="panel panel--hero">
        <div>
          <p class="muted">Поддерживаем файлы и ручной ввод</p>
          <h1>Подключите поток данных и контролируйте тональность обращений</h1>
          <p class="hero__lead">
            Веб-приложение принимает обращения граждан, классифицирует их на позитивные,
            негативные и нейтральные, сохраняет историю и визуализирует качество модели.
          </p>
          <div class="hero__chips">
            <div class="chip"><span class="dot dot--positive"></span><span id="model-name">Модель</span></div>
            <div class="chip" id="model-detail">Классы: —</div>
            <div class="chip"><span class="dot"></span>Всего предсказаний: <span id="total-counter">0</span></div>
          </div>
        </div>
        <div class="score-card">
          <div class="score-card__header">
            <p>Macro F1 Score</p>
            <span class="badge">Live</span>
          </div>
          <div class="score-card__body">
            <div class="dial" id="macro-f1-progress">
              <div class="dial__value" id="macro-f1-value">—</div>
            </div>
            <div class="score-meta">
              <p class="muted">Качество модели</p>
              <p id="macro-f1-caption">Запустите make evaluate, чтобы обновить метрики.</p>
            </div>
          </div>
        </div>
      </section>

      <section class="grid grid--two">
        <article class="card table-card">
          <div class="card__header">
            <div>
              <p class="muted">Стриминг</p>
              <h2>Поток данных (Live)</h2>
            </div>
            <div class="chip chip--live">В реальном времени</div>
          </div>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Текст</th>
                  <th>Тональность</th>
                  <th>Уверенность</th>
                  <th>Время</th>
                </tr>
              </thead>
              <tbody id="history"></tbody>
            </table>
            <p class="muted" id="history-empty">Нет последних обращений — выполните анализ или загрузите файл.</p>
          </div>
        </article>

        <article class="card metrics-card">
          <div class="card__header">
            <div>
              <p class="muted">Мониторинг</p>
              <h2>Сводка модели</h2>
            </div>
            <div class="chip">Данные обновляются</div>
          </div>
          <div class="metrics-grid">
            <div class="metric">
              <p class="metric__label">Accuracy</p>
              <p class="metric__value" id="metric-accuracy">—</p>
              <p class="muted" id="metrics-dataset">Нет отчёта</p>
            </div>
            <div class="metric">
              <p class="metric__label">Macro F1</p>
              <p class="metric__value" id="metric-macro-f1">—</p>
              <p class="muted" id="metrics-updated"></p>
            </div>
            <div class="metric">
              <p class="metric__label">Датасет</p>
              <p class="metric__value" id="session-dataset">—</p>
              <p class="muted">Версия отчёта</p>
            </div>
          </div>
          <div class="label-breakdown" id="label-breakdown"></div>
        </article>
      </section>

      <section class="grid grid--two">
        <article class="card">
          <div class="card__header">
            <div>
              <p class="muted">Ручной ввод</p>
              <h2>Анализ обращения</h2>
            </div>
          </div>
          <form id="analyze-form" class="stack">
            <label for="feedback-text">Сообщение</label>
            <textarea
              id="feedback-text"
              name="text"
              rows="6"
              maxlength="2000"
              placeholder="Например: \"Спасибо за удобный сервис записи к врачу!\""
              required
            ></textarea>
            <button class="primary" type="submit">Анализировать</button>
          </form>
          <div class="result" id="result">
            <p class="muted">Введите текст и нажмите «Анализировать», чтобы получить прогноз.</p>
          </div>
          <div class="bars" id="probability-bars"></div>
        </article>

        <article class="card">
          <div class="card__header">
            <div>
              <p class="muted">Обратная связь</p>
              <h2>Подтвердите или исправьте результат</h2>
            </div>
            <div class="badge badge--ghost">Используется для дообучения</div>
          </div>
          <form id="correction-form" class="feedback-form stack">
            <fieldset class="feedback-form__choices">
              <legend>Верная тональность</legend>
              <label><input type="radio" name="user-label" value="positive" /> Положительная</label>
              <label><input type="radio" name="user-label" value="neutral" /> Нейтральная</label>
              <label><input type="radio" name="user-label" value="negative" /> Отрицательная</label>
            </fieldset>
            <label for="feedback-notes">Комментарий (опционально)</label>
            <textarea
              id="feedback-notes"
              rows="3"
              maxlength="500"
              placeholder="Например: модель не учла вторую часть сообщения"
            ></textarea>
            <button class="secondary" type="submit" id="feedback-submit">Отправить исправление</button>
            <p id="feedback-status" class="feedback-form__status">
              Сначала выполните анализ, чтобы отправить корректировку.
            </p>
          </form>
        </article>
      </section>

      <section class="card" id="bulk-section">
        <div class="card__header">
          <div>
            <p class="muted">Пакетная обработка</p>
            <h2>CSV-классификация</h2>
            <p class="muted">
              Загрузите CSV-файл с колонкой <code>text</code>, чтобы обработать до 1000 обращений и
              получить распределение тональностей. Результаты можно скачать и добавить в отчёт.
            </p>
          </div>
          <div class="badge">UTF-8</div>
        </div>
        <form id="bulk-form" class="bulk-form">
          <label class="file-input">
            <span id="bulk-file-label">Выберите CSV-файл</span>
            <input type="file" id="bulk-file" accept=".csv,text/csv" required />
          </label>
          <button class="primary" type="submit">Классифицировать файл</button>
          <p id="bulk-status" class="bulk-form__status">Файл должен содержать колонку <code>text</code>.</p>
        </form>
        <div id="bulk-summary" class="bulk-summary hidden"></div>
        <div id="bulk-table" class="bulk-table hidden"></div>
        <button id="bulk-download" class="secondary hidden">Скачать результаты (CSV)</button>
      </section>

      <section class="grid grid--two" id="reports">
        <article class="card">
          <div class="card__header">
            <div>
              <p class="muted">Качество</p>
              <h2>Метрики классификации</h2>
              <p class="muted">Обновите отчёт через <code>make evaluate</code>.</p>
            </div>
          </div>
          <div class="metrics-table" id="metrics-table">
            <table>
              <thead>
                <tr>
                  <th>Класс</th>
                  <th>Precision</th>
                  <th>Recall</th>
                  <th>F1</th>
                  <th>Support</th>
                </tr>
              </thead>
              <tbody id="metrics-table-body">
                <tr>
                  <td colspan="5" class="muted">Метрики появятся после запуска make evaluate</td>
                </tr>
              </tbody>
            </table>
            <div class="metrics-confusion" id="metrics-confusion"></div>
          </div>
        </article>

        <article class="card">
          <div class="card__header">
            <div>
              <p class="muted">История</p>
              <h2>Сводка обращений</h2>
              <p class="muted">Выполните <code>make history-report</code> для обновления показателей.</p>
            </div>
          </div>
          <div class="history-summary">
            <div class="summary-card">
              <p class="muted">Всего записей</p>
              <p class="metric__value" id="history-total">0</p>
              <p class="muted" id="history-range">Нет отчёта</p>
            </div>
            <div class="summary-card">
              <p class="muted">Средняя длина</p>
              <p class="metric__value" id="history-average">0</p>
              <p class="muted">символов</p>
            </div>
          </div>
          <div class="history-lists">
            <div>
              <h4>Распределение классов</h4>
              <ul id="history-labels" class="history-list"></ul>
            </div>
            <div>
              <h4>Активность по датам</h4>
              <ul id="history-dates" class="history-list"></ul>
            </div>
          </div>
          <p class="muted" id="history-updated"></p>
        </article>
      </section>

      <section class="card card--footer">
        <p>
          Стек: Python (FastAPI, scikit-learn), HTML/CSS/JS. API доступно по адресу
          <code>/predict</code>, <code>/predict_batch</code>, <code>/stats</code>.
        </p>
      </section>
    </main>
  </body>
</html>
